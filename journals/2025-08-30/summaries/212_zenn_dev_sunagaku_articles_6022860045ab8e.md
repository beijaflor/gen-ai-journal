## Claude Codeで、サブエージェントをまとめるサブエージェントを作って、コンテキストを汚染させないようにしてみた

https://zenn.dev/sunagaku/articles/6022860045ab8e

Claude Codeのサブエージェント利用においてコンテキスト汚染を回避するため、サブエージェントを統括するマネージャーエージェントを導入する新たな管理手法を提案・検証した。

**Content Type**: ⚙️ Tools

**Scores**: Signal:4/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:5/5
**Main Journal**: 88/100 | **Annex Potential**: 87/100 | **Overall**: 88/100

**Topics**: [[Claude Code, サブエージェント, コンテキスト管理, エージェントオーケストレーション, AI駆動開発]]

この記事は、Claude Codeにおけるサブエージェントの利用に伴うコンテキスト汚染と管理の課題に対し、革新的な解決策を提示しました。Claude Codeのサブエージェント機能は、特定の専門知識を分離し、メインエージェントの精度向上に寄与する一方で、サブエージェントが増えすぎるとメインエージェントがどのサブエージェントを使うべきか判断に迷い、また登録自体がコンテキストを消費するという問題が発生していました。

そこで筆者は、この問題を解決するため「エキスパートマネージャー」と呼ぶサブエージェントを導入する手法を提案・検証しました。このマネージャーエージェントは、専門知識自体は保持せず、質問内容に応じて最適な専門家サブエージェントを選択し、その呼び出しを仲介する役割に特化します。

具体的な実装として、メインエージェントはエキスパートマネージャーのみを認識し、専門的な質問をマネージャーに一任します。エキスパートマネージャーは、`.claude/expert-agents/`という独立したディレクトリに格納された各専門家サブエージェント（例：野菜専門家、魚専門家）を、ファイルタグ（`@`）とパス指定で直接呼び出します。これにより、メインエージェントからは専門家サブエージェント群の存在が完全に隠蔽されます。

このアプローチの重要性は多岐にわたります。第一に、メインエージェントのコンテキストを最小限に保ち、不要な専門知識による汚染を防ぐことで、推論効率と安定性を大幅に向上させます。これは、限られたコンテキストウィンドウを最大限に活用し、大規模なAI駆動開発プロジェクトにおけるシステムの複雑性を抑制するために不可欠です。第二に、エージェントの責任を明確に分離し、スケーラビリティを高めます。新たな専門家エージェントを追加しても、メインエージェントのプロンプトに変更を加える必要がなく、システム拡張を容易にします。ウェブアプリケーション開発において、頻繁な機能追加や変更が求められる環境で、AIエージェントを柔軟にスケールさせるための設計思想として、この手法は極めて有効です。

この検証は、小規模プロジェクトでの有効性が確認されており、複雑化するAIエージェントシステムを効率的に構築・運用するための具体的な指針を提供するものです。