## Claude CodeにLSPツールが追加

https://blog.lai.so/claude-code-lsp/

Claude Code v2.0.74におけるLSPサポートの追加を報告し、大規模リポジトリでの探索精度向上とトークン削減効果を実証する。

**Content Type**: ⚙️ Tools
**Language**: ja

**Scores**: Signal:5/5 | Depth:4/5 | Unique:4/5 | Practical:4/5 | Anti-Hype:4/5
**Main Journal**: 88/100 | **Annex Potential**: 85/100 | **Overall**: 84/100

**Topics**: [[Claude Code, LSP, コード探索, トークン削減, 開発ツール]]

AnthropicのCLIツール「Claude Code」において、Language Server Protocol（LSP）の統合が正式にサポートされた。筆者は以前からこの機能の追加を予想しており、最新のアップデート（v2.0.74以降）で「lspServers」を定義可能になったことで、シンボルの定義検索、参照検索、ホバー情報の取得といった高度なコード操作が可能になったと述べている。

著者はこの機能の意義を、単なる新機能の追加ではなく「大規模コードベースにおける探索の精度向上とリソース効率の最適化」にあると位置づけている。具体的には、従来のGrepやファイル検索では困難だった文脈依存のシンボル探索が、LSPツールによって高速かつ正確に実行されるようになる。実装面では、`/plugin`コマンドや`plugin.json`を通じて`typescript-language-server`などの外部LSPサーバーと連携する仕組みとなっており、主要な言語の多くで動作が確認されている。

著者は、数十万行規模のリポジトリ（Expensify/App）を用いた実戦的な検証を行っている。SWE-Lancerのタスクを題材に、従来の「Grep検索のみ」のケースと「LSPツール併用」のケースを比較した結果、LSPを利用することで分析レポートの品質が向上し、かつトークン消費量を約15%削減（約46,000から約39,000へ）できたことを示している。これは、LLMがコードを「読んで」理解する前に、LSPが「構造的に」場所を特定することで、無駄なコンテキストの読み込みを回避できるためである。

一方で、現状のLSPツールは「読み取り専用」の操作に限定されていること、また`workspaceSymbol`のようにクエリ指定に制約がある場合は依然としてGrepへのフォールバックが発生することなど、いくつかの限界も指摘されている。最新版（2.0.74）での接続の不安定さにも触れ、フィーチャーフラグ（`ENABLE_LSP_TOOL=1`）を用いた安定版の利用を推奨するなど、実用的なアドバイスも含まれている。著者の結論として、LSP統合は巨大なコードベースを扱うエンジニアにとって、精度とコストの両面で大きな恩恵をもたらす強力な武器になると結論づけている。