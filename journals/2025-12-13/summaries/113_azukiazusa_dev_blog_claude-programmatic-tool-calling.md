## Claude のプログラミングによるツール呼び出し

https://azukiazusa.dev/blog/claude-programmatic-tool-calling/

Claudeの新たなプログラミングによるツール呼び出し機能は、従来のツール呼び出しにおけるコンテキスト汚染と推論オーバーヘッドの問題を、LLMがPython実行環境でツールをオーケストレーションすることで解決します。

**Content Type**: ⚙️ Tools
**Language**: ja

**Scores**: Signal:5/5 | Depth:4/5 | Unique:3/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 85/100 | **Annex Potential**: 80/100 | **Overall**: 84/100

**Topics**: [[Claude, ツール呼び出し, プログラミング実行環境, コンテキスト汚染, ワークフロー自動化]]

この記事は、ClaudeのModel Context Protocol (MCP) を利用した従来のツール呼び出しが抱える「ツール実行中間結果によるコンテキスト汚染」と「推論のオーバーヘッド、手作業による結果合成」という二つの課題に焦点を当て、その解決策として導入された「プログラムによるツール呼び出し」機能について詳しく解説しています。

著者は、この新機能によりClaudeがPythonプログラム実行環境内で複数のツールを連携・実行できるようになったと説明します。これにより、LLMは個々のツール呼び出しの中間結果を逐一コンテキストに追加する代わりに、プログラム内で結果を処理・組み合わせ、最終的な出力のみをコンテキストに返すことが可能になります。このアプローチは、特に検索ツールの結果のように大量の情報が返される場合にコンテキストウィンドウの効率を大幅に向上させ、不必要な情報の埋没を防ぎます。

また、LLMがPythonの条件分岐やループといったプログラミングロジックを駆使してツールを呼び出すことで、複雑なマルチステップのワークフローをより信頼性高く、かつ推論のオーバーヘッドを削減しながら実行できると強調しています。具体的には、「商品検索→カート追加→注文確定」のような一連の操作において、各ステップでのLLMによる度重なる推論が不要となり、応答時間の短縮に繋がります。

記事では、TypeScript SDKを用いた具体的なコード例を通して、この機能の実装方法を解説しています。ベータ版機能であるため、`betas`オプションの指定や、`claude-sonnet-4-5`または`claude-opus-4-5`モデルの使用が必須であること、`code_execution_20250825`ツールと`allowed_callers`オプションの設定方法などが示されています。さらに、ツール実行環境となるコンテナがセッションごとに作成され、約4.5分間の有効期限があること、そしてAPIリクエストを複数回繰り返してツールの実行結果を逐次処理するワークフローについても具体的に説明されています。

プログラムによるツール呼び出しが特に有用なケースとして、大規模データの集計・要約、3つ以上の依存ツール呼び出しを含むマルチステップのワークフロー、ツール結果のフィルタリング・ソート・変換、中間結果が不要な場合、多数の項目にわたる並列処理などが挙げられています。単純な単一ツール呼び出しではオーバーヘッドが発生するため推奨されないと注意喚起しており、ツールの結果はプログラミングによる解析を容易にするためJSONやXMLのような構造化された形式で返すことが推奨されています。