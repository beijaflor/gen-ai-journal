## AI 対話型アプリケーションにおけるセキュリティ実践ガイド #AWS

https://qiita.com/naomichi-y/items/5fad488daacea06e0839

AI 対話型アプリケーションが抱えるプロンプトインジェクション等の新たなセキュリティ脅威に対し、多層防御アプローチによる具体的な対策を解説する。

**Content Type**: Tutorial & Guide
**Language**: ja

**Scores**: Signal:4/5 | Depth:4/5 | Unique:3/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 85/100 | **Annex Potential**: 79/100 | **Overall**: 80/100

**Topics**: [[AIアプリケーションセキュリティ, プロンプトインジェクション, 多層防御, AWS Bedrock, 自然言語データベースインターフェース]]

AIアプリケーション開発が容易になる一方で、OWASP LLM Top 10 (2025年版) でも最大の脅威とされるプロンプトインジェクションなど、AI特有のセキュリティリスクへの対策が急務となっている。本記事は、マルチテナント対応のAI対話型アプリケーションを想定し、業界のベストプラクティスに基づいた具体的なセキュリティ実践ガイドを提示する。

著者は、プロンプトインジェクション、データ漏洩、予算超過、間接的プロンプトインジェクション、リソース枯渇といった主な脅威に対し、以下の4層による多層防御アプローチを推奨している。

1.  **AIモデルレベルの防御**:
    *   **プロンプトインジェクション攻撃の理解と対策**: 直接的・間接的な攻撃手法を例示し、AIモデルの動作を制御する最初の防御線としてシステムプロンプトの堅牢な定義を強調。アクセス可能なデータベースや操作の制限、禁止事項の明確化が重要であり、ユーザー入力とシステムプロンプトの分離を必須とする。Amazon BedrockのConverseStream APIでのシステムプロンプト制御例も示されている。
    *   **ガードレールの活用**: Amazon Bedrock Guardrailsのような機能を用いて、コンテンツフィルタリング、トピック制限、個人情報マスキング、機密情報保護による追加的な安全機構を構築する。
    *   **出力の検証と信頼度スコアリング**: AIモデルの回答に信頼度スコアを付与し、不正確な情報や推測に基づく回答を識別・対処する。

2.  **アプリケーションレベルの防御**:
    *   **入力検証とサニタイゼーション**: 質問の文字数・トークン数制限や、SQL操作キーワード、システムコマンド、ディレクトリトラバーサルといった禁止パターンの検出を必須とする。
    *   **レート制限とクォータ管理**: 従量課金制のAIモデル呼び出しによる予算超過を防ぐため、ユーザー・テナント単位でのリクエスト数制限やトークンベースのクォータを設定する。Amazon BedrockのCountTokens APIによるトークン使用量の事前見積もりと監視が有効である。
    *   **レスポンスの構造化と検証**: 自然言語でデータベースに問い合わせるMCP（Microservice Communication Protocol - 本文では自然言語でDBに問い合わせる機能として使用）サーバーからの応答を構造化し、テナントIDや信頼度スコアなどのメタデータを含めて厳密に検証することで、データ漏洩リスクを軽減する。
    *   **認証とセッション管理**: 各リクエストで適切な認証と認可を実施し、ユーザーID、テナントID、ロール、権限、有効期限を含む認証トークンを用いてアクセス権限を管理する。
    *   **MCPツールの実行制限**: MCPサーバーが提供するツールのうち、アプリケーションに必要最小限のもののみを明示的に許可し、意図しないツール呼び出しを防ぐ。

3.  **データベースレベルの防御**:
    *   **マルチテナント分離**: データベース分離、スキーマ分離、Row-Level Securityのいずれかの方法でテナント間のデータ分離を徹底する。
    *   **読み取り専用権限の徹底**: MCPサーバー経由のデータベースアクセスはSELECTクエリのみに制限し、不正なINSERT、UPDATE、DELETE、DROPなどの実行をデータベースレベルでブロックする。
    *   **クエリの監視とブロック**: 異常なクエリパターンを検知し、実行時間、スキャン行数、同時接続数に上限を設定して自動的にブロックする。
    *   **監査ログと監視**: すべてのAIモデル呼び出しや重要なアクションを記録し、異常検知に活用する。Amazon BedrockであればCloudWatchやS3へのログ記録が可能。

4.  **インフラレベルの防御**:
    *   **ネットワークセグメンテーション**: MCPサーバーとデータベースをインターネットから直接アクセスできないプライベートサブネットに配置し、多層的なネットワーク隔離を行う。

結論として、著者はAIを活用したアプリケーションの利便性を認めつつも、プロンプトインジェクションなどのAI特有の新たなセキュリティリスクに対し、従来のWebセキュリティの知識だけでは不十分であり、これらの多層的な対策が不可欠であると強調している。