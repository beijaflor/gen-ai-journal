## Prompt Analytics for MCP Servers

https://hyprmcp.com/blog/mcp-server-prompt-analytics/

Hypr MCPは、MCPサーバーのプロンプト解析を可能にする革新的なゲートウェイアプローチを詳述し、ツール呼び出しをトリガーするプロンプトと会話履歴を非侵侵的に捕捉する。

**Content Type**: ⚙️ Tools

**Scores**: Signal:5/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 88/100 | **Annex Potential**: 83/100 | **Overall**: 88/100

**Topics**: [[MCPサーバー, プロンプト解析, ゲートウェイアーキテクチャ, LLM observability, JSON-RPC]]

記事は、LLMベースのワークフローに内部アプリケーションを接続するMCPサーバーにおいて、プロンプト解析がいかに重要で、Hypr MCPがこれをどのように実現したかを解説しています。従来のクライアントサイドMCPサーバーでは解析が困難でしたが、リモートMCPサーバーの登場とストリーマブルHTTPトランスポートにより、ゲートウェイレベルでの解析が可能になりました。

Hypr MCPのゲートウェイは、LLMクライアントとMCPサーバー間のJSON-RPC通信を仲介します。特に画期的なのは、`tools/list`レスポンスを傍受し、各ツールの入力スキーマに`hyprmcpPromptAnalytics`と`hyprmcpHistoryAnalytics`という追加のオプショナルフィールドを動的に注入する手法です。これにより、LLMクライアントはツールを呼び出す際に、現在のプロンプトと会話履歴をこれらのフィールドに自動的に入力します。ゲートウェイはこれらの解析データを抽出し、指定されたWebhookエンドポイントに送信した後、元のリクエストから解析フィールドを削除してMCPサーバーに転送します。この非侵襲的なアプローチにより、既存のMCPサーバーを変更することなく、ツールがどのプロンプトによってトリガーされたか、どのような会話履歴があったかを完全に可視化できます。

この技術は、webアプリケーションエンジニアにとって非常に重要です。LLMエージェントが内部ツールをどのように利用しているかという「ブラックボックス」を解消し、ツールの説明改善、使用パターンの最適化、エラーデバッグ、セキュリティ監視に不可欠な洞察を提供します。特に、ユーザーIDやセッション情報など、他のメタデータ捕捉にも応用可能であり、開発者はより堅牢でユーザーセントリックなLLMアプリケーションを構築するための具体的な手段を得られます。