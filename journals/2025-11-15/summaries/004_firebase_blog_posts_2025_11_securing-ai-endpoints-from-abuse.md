## 小売店のAIエンドポイントを悪用から保護する：バーチャル試着の事例

https://firebase.blog/posts/2025/11/securing-ai-endpoints-from-abuse/

**Original Title**: Securing a retail AI endpoint from abuse for virtual try on

Firebaseを活用し、仮想試着AIエンドポイントを非承認クライアント、リプレイ攻撃、非認証ユーザー、過剰なリクエスト、および不正な入力から多層的に保護することで、コストと悪用リスクを大幅に削減します。

**Content Type**: Tutorial & Guide
**Language**: en

**Scores**: Signal:5/5 | Depth:4/5 | Unique:3/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 88/100 | **Annex Potential**: 82/100 | **Overall**: 84/100

**Topics**: [[AIエンドポイントのセキュリティ, Firebase App Check, レート制限, プロンプトインジェクション対策, ユーザー認証]]

この記事は、AI機能の実行コストが高いことから、そのエンドポイントを悪用から保護する重要性を強調し、Firebaseを活用した具体的な対策を解説しています。特に、仮想試着アプリケーションを例に、エンドポイントのセキュリティを多層的に強化する手法が、ウェブアプリケーションエンジニア向けに詳細なコード例と共に説明されています。

著者は、AI機能の悪用を防ぐための主要な対策として、以下の5点を挙げています。

1.  **非承認クライアントからの保護 (App Check)**: App Checkを実装することで、リクエストが「本物のデバイス上の本物のユーザー」から来ていることを証明し、cURLや不正なサイトからのアクセスを制限します。クライアント側で認証トークンを取得し、サーバー側で検証することで、正当なユーザーのみが仮想試着機能を利用できるようになります。

2.  **リプレイ攻撃からの保護 (Replay Protected Token)**: 同じApp Checkトークンの使い回しを防ぐため、`getLimitedUseToken`でリクエストごとに新しい限定使用トークンを取得し、サーバー側で`verifyToken({consume: true})`を呼び出してそのトークンを「消費済み」とマークします。これにより、一度使用されたトークンは再利用できなくなり、不正なリクエストの繰り返しを防ぎます。

3.  **非認証ユーザーからの保護 (User Authentication)**: Firebase Authenticationを用いてユーザーを認証し、許可されたユーザーのみがAIエンドポイントにアクセスできるようにします。さらに、メール確認済みユーザーのみに機能を制限するなど、詳細なアクセス制御も可能です。

4.  **過剰なリクエストからの保護 (Rate Limiting)**: 認証済みユーザーに対して、サーバー側で時間あたりのリクエスト数を制限するレートリミッターを実装します。これにより、個々のユーザーがAIリソースを過度に消費するのを防ぎ、コストの管理とサービス品質の維持を図ります。記事では、Firestoreを使った簡易的なレートリミッターの例が示されています。

5.  **入力制限による悪用防止 (Input Limiting)**: プロンプトインジェクション攻撃やAIの不正利用を防ぐため、APIエンドポイントが受け付ける入力を厳密に制限することが推奨されています。例えば、仮想試着機能では製品のSKUのみを受け付け、ユーザーの画像やプロンプトはサーバー側で取得・生成することで、ユーザーがAIモデルに任意の情報を挿入するリスクを排除します。

これらの対策を組み合わせることで、小売店はAI機能を安全に提供し、不正利用によるコスト増大やセキュリティリスクから自身を保護できると、著者は結論付けています。