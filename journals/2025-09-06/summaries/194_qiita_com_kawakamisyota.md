## MCPにおけるセキュリティリスク #AI

https://qiita.com/KawakamiSyota/items/9a81cdcb8e94a38748d7

MCP認証フローにおける「混乱した副官問題」というセキュリティリスクを詳細に解説し、開発者が講じるべき具体的な技術的対策を提示する。

**Content Type**: Technical Reference

**Scores**: Signal:4/5 | Depth:4/5 | Unique:3/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 81/100 | **Annex Potential**: 78/100 | **Overall**: 80/100

**Topics**: [[MCP, OAuth認証, セキュリティリスク, 混乱した副官問題, Agentベース開発]]

株式会社ベーシックの川上氏によるこの記事は、Anthropicが発表したMCP（Multi-Agent Communication Protocol）をめぐるセキュリティリスクに深く切り込んでいます。特に、MCPサーバーとクライアント間のHTTP通信で採用されるOAuth認証フローにおける「混乱した副官問題」という脆弱性が詳細に解説されており、webアプリケーションエンジニアにとって見過ごせない内容です。

MCPサーバーはOAuthクライアントとして機能し、アクセストークンを用いて保護されたリソースへの要求を受け入れます。この認証フローは、ユーザーが直接パスワードを共有することなく、VSCodeのようなクライアントがGitHubなどの外部認証サーバーのリソースにアクセスできるよう安全に認可を委譲する仕組みです。しかし、「混乱した副官問題」では、攻撃者が正当な認証フローに割り込み、本来MCPクライアントに送られるべきMCP認証コードを自身のクライアントにリダイレクトさせることで、ユーザーのリソースへ不正アクセスを行う危険性があります。これは、MCPプロキシサーバーが認証情報をどのクライアントに発行すべきか正確に識別できないことに起因します。

開発者はこの脆弱性に対し、厳格なリダイレクトURI検証、認可コード横取り攻撃を防ぐためのPKCE（Proof Key for Code Exchange）の実装、そしてCSRF攻撃を防ぐStateパラメータの導入という具体的な対策を講じる必要があります。これらの対策は、OAuth認証システムをセキュアに運用するための基本的なベストプラクティスであり、MCPという新しいプロトコル環境下でもその重要性は変わりません。

今後、AIエージェントを活用した開発が加速する中で、MCPのようなプロトコルの利用機会は増大するでしょう。このため、我々ウェブアプリケーションエンジニアは、単に便利さだけでなく、このようなセキュリティの根本的な仕組みとリスクを理解し、安全な実装と運用を徹底することが不可欠です。この記事は、Agentベースの開発に携わるエンジニアが直面するであろう新たなセキュリティ課題に対し、実践的な指針を提供しています。