## 防御システムが本来の目的を超えて存続する時：大規模な防御システム管理の教訓

https://github.blog/engineering/infrastructure/when-protections-outlive-their-purpose-a-lesson-on-managing-defense-systems-at-scale/

**Original Title**: When protections outlive their purpose: A lesson on managing defense systems at scale

防御システムが技術的負債化し正当なユーザーを誤ってブロックするリスクを指摘し、インシデント対策におけるライフサイクル管理と可観測性の重要性を提唱する。

**Content Type**: 🛠️ Technical Reference
**Language**: en

**Scores**: Signal:5/5 | Depth:4/5 | Unique:4/5 | Practical:4/5 | Anti-Hype:5/5
**Main Journal**: 87/100 | **Annex Potential**: 86/100 | **Overall**: 88/100

**Topics**: [[Infrastructure, SRE, Observability, Rate Limiting, Technical Debt]]

GitHubのエンジニアリングチームは、プラットフォームの可用性を守るために導入された防御メカニズム（レート制限やトラフィック制御など）が、時間とともに「技術的負債」となり、正当なユーザーを妨げる要因になった事例と、そこから得られた教訓を公開した。

事象の発端は、GitHubを普通にブラウジングしている一部のユーザーから、リクエスト過多を示す「429 Too many requests」エラーが発生しているという報告だった。調査の結果、原因は過去の不正利用インシデントの際に緊急対応として導入された防御ルールにあった。これらのルールは、特定のブラウザフィンガープリントと特定のビジネスロジックを組み合わせた「複合シグナル」に基づいてトラフィックをブロックしていたが、インシデント終了後も削除されずに残っていたため、現在の正当なユーザーの利用パターンの一部を誤って「不正」と判定してしまっていた。

著者は、この問題が大規模な防御システムを運用する上での典型的な罠であると指摘している。インシデント発生時の緊急対策は、サービスの可用性を維持するために多少の誤検知を許容してでも迅速に導入される。しかし、脅威のパターンが変化し、新しいツールや利用形態が登場する中で、これらの古いルールは時間の経過とともに陳腐化し、副作用だけが蓄積していく。GitHubのような多層的なインフラ構成では、どの層でブロックが発生しているかを追跡するために複雑なログの相関分析が必要となり、問題の発見を遅らせる要因にもなっていた。

この経験から、著者は防御システムの運用における以下の3つの重要性を強調している。
1. **可観測性（Observability）の強化**: 複数の保護レイヤーを横断して制限の発生源を迅速に特定できる仕組みを構築すること。
2. **ライフサイクル管理**: インシデント緩和策をデフォルトで「一時的なもの」として扱い、有効期限（TTL）の設定や、事後レビューをプロセスとして義務化すること。
3. **積極的なメンテナンス**: 緊急時のルールを放置せず、恒久的な対策へと進化させるか、不要になった時点で確実に削除する意思決定を行うこと。

Webアプリケーションエンジニアにとっての教訓は、インフラの防御設定もアプリケーションコードと同様にメンテナンスが必要な資産であるという点だ。「安全のために厳しめの制限をかけておく」という判断が、長期的にはサイレントにユーザーを排除する技術的負債になり得る。防御策の導入と削除をライフサイクルの一部として設計に組み込むことの重要性を、実例を持って示している。