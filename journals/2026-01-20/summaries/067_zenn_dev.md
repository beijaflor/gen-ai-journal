## Agent Skills Scriptsアンチパターン その1

https://zenn.dev/tkithrta/articles/6e36550369a65e

AIエージェントの拡張機能（Agent Skills）用スクリプト開発において、Bashの回避や適切なエラーハンドリングによるエージェントの混乱防止といったプラクティスを提示する。

**Content Type**: 🛠️ Technical Reference
**Language**: ja

**Scores**: Signal:4/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 84/100 | **Annex Potential**: 84/100 | **Overall**: 84/100

**Topics**: [[Agent Skills, AIエージェント, Claude Code, エラーハンドリング, Bun]]

AIエージェントが実行可能なコードを呼び出してタスクを遂行する「Agent Skills」の仕様に基づき、開発者が陥りやすいアンチパターンとその対策を解説した記事である。自作のAIエージェント「Magica」の開発経験を基に、エージェントが「道具」を正しく使いこなすためのスクリプト設計思想が綴られている。

著者がまず警鐘を鳴らすのは、スキル実行用スクリプトをBashで記述することだ。Agent Skillsの仕様上はサポートされているものの、OS依存（Windowsでの動作不安定）、可読性・保守性の低さ、脆弱な型概念といった問題から、PythonやJavaScript（TypeScript）の利用を強く推奨している。特に注目すべきは、ネイティブビルド版「Claude Code」がJavaScriptランタイムのBunで動作している点を利用したテクニックだ。環境変数`BUN_BE_BUN=1`を設定することで、Claude Codeそのものをランタイムとしてスキル実行に利用できるという実践的な知見を提供している。

後半では、AIエージェント特有の挙動に基づいたエラーハンドリングの重要性を説いている。著者は「AIエージェントにスタックトレースを見せてはならない」と主張する。スクリプトが例外を吐き出し生のトレースが表示されると、エージェントの関心が「本来のタスク遂行」から「スクリプトのデバッグ・修正」へと逸れてしまうためだ。これにより、スキルが想定外の形に改変されたり、削除されたりするリスクが生じる。

この問題を解決するため、著者は以下の具体的な設計指針を提示している。
1. **明示的な例外処理**: try-exceptを用いてエラーを捕捉し、エージェントが理解しやすい形式で出力する。
2. **標準出力と標準エラー出力の分離**: 計算結果などの「成果物」と、エラーメッセージを明確に分けることで、エージェントに適切なコンテキストを渡す。
3. **Usage（使い方）の提示**: 引数不足などのエラー時には、再実行のヒントとなるUsageメッセージを併記する。

これらのアプローチは、プログラムの堅牢性を高めるだけでなく、AIエージェントという「新しいユーザー」とのインターフェース設計において極めて重要である。エージェントが自律的に問題を解決しようとする性質を理解し、それを正しい方向へ誘導するための「親切なスクリプト設計」こそが、AI駆動開発の安定性を左右するというのが著者の主要なメッセージである。