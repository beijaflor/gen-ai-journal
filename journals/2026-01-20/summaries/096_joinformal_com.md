## プロキシを使用してClaude Codeから機密情報を隠蔽する方法

https://www.joinformal.com/blog/using-proxies-to-hide-secrets-from-claude-code/

**Original Title**: Using Proxies to Hide Secrets from Claude Code

開発エージェントによる秘密情報の流出を防ぐため、プロキシを用いた認証情報の動的注入とネットワーク隔離を組み合わせた「最小権限原則」の適用手法を提案する。

**Content Type**: ⚙️ Tools
**Language**: en

**Scores**: Signal:4/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 86/100 | **Annex Potential**: 84/100 | **Overall**: 84/100

**Topics**: [[Claude Code, セキュリティ, プロキシ, 秘密情報管理, エージェント]]

エージェント型コーディングツール、特にClaude Codeの普及に伴い、開発環境における秘密情報の保護が喫緊の課題となっている。筆者は、これらのツールが環境変数やローカルファイルへの広範なアクセス権を持ち、さらに外部通信を行う能力を有していることから生じる「機密データへのアクセス」「外部通信」「信頼できないコンテンツへの露出」という3つのリスク（致命的な三要素）を指摘している。

既存の対策として、AnthropicはOS Xのsandbox-execを利用したサンドボックスや、devcontainer用のIPベースのファイアウォールを提供している。しかし筆者によれば、IPレイヤーでの制御には限界がある。例えば、GitHubやnpmなどの許可済みドメインを悪用したデータ漏洩や、SSHポート（22番）を介した通信、ドメインフロントリングなどの手法により、従来のサンドボックスは回避される可能性があるからだ。

この問題に対し、筆者は「ネットワークプロキシ」を活用した、より粒度の細かいアクセス制御手法を提案している。具体的には、mitmproxy等のツールを用いてClaude Codeのトラフィックを傍受し、アプリケーションレイヤーで機密情報を管理する方法だ。最大の特徴は、エージェント（Claude Code）プロセス自体には「ダミーのAPIキー」のみを渡し、プロキシ側で実際の有効なキーへと動的に差し替えて上流のAPIにリクエストを送信する点にある。

このアプローチの利点は、機密情報をLLMのコンテキストウィンドウやプロセスのメモリから完全に隔離できることだ。記事では、`HTTP_PROXY`環境変数や`NODE_EXTRA_CA_CERTS`を用いた具体的な構成方法に加え、mitmproxyのアドオンを利用して特定のホストへのリクエストを再ルーティングするテクニックについても技術的に詳しく解説されている。

さらに、組織レベルでの対策として「Formal Connector」のようなプロキシソリューションを導入することで、開発者個人の権限とエージェントの権限を分離し、最小権限の原則（Least Privilege）を徹底できると主張している。これにより、万が一エージェントが意図しない挙動を示したとしても、秘密情報の流出リスクを最小限に抑えつつ、全てのAPI呼び出しの可視性と監査ログを確保することが可能になる。エンジニアにとって、利便性の高いAIツールを利用しながら、実務レベルのセキュリティを維持するための極めて実践的な知見となっている。