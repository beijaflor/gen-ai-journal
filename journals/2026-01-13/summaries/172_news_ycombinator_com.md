## LLVMを用いた独自ランタイム開発におけるCRTリンク回避の技術的課題

https://news.ycombinator.com/item?id=46465866

**Original Title**: Ask HN: Help with LLVM

分析し、LLVMを用いた独自言語開発においてWindows環境で発生するCランタイム（CRT）の強制リンク問題を回避するための専門的な手法を提示する。

**Content Type**: ⚙️ Tools
**Language**: en

**Scores**: Signal:4/5 | Depth:4/5 | Unique:3/5 | Practical:3/5 | Anti-Hype:5/5
**Main Journal**: 72/100 | **Annex Potential**: 72/100 | **Overall**: 76/100

**Topics**: [[LLVM, Compiler, Runtime, C Runtime (CRT), MSVC ABI]]

本記事は、LLVMを使用して独自のプログラミング言語とランタイムを開発しているエンジニアが、Windows環境におけるCランタイム（CRT）の強制的なリンクを回避できないという技術的な壁に直面し、それに対する専門的な解決策をハッカーニュースのコミュニティで議論したものです。質問者は、浮動小数点数を使用する際にLLVMが自動的に`_fltused`シンボルを注入してしまい、自身で定義したスタブライブラリと衝突してエラーが発生する状況に陥っています。この問題に対し、AIや一般的な検索では解決策が得られなかったと述べており、コンパイラ基盤の深層における挙動の複雑さが浮き彫りになっています。

議論の中で、この挙動はLLVMがMSVC ABI（Application Binary Interface）をターゲットにする際に、バックエンドでハードコードされたロジックによって発生していることが指摘されました。具体的には、LLVMのソースコード内で浮動小数点型の参照がある場合に特定のシンボルを放出する処理が含まれており、標準的なコンパイラフラグだけではこれを完全に抑制することが困難です。コミュニティからは、MSVCのリンカ（LINK.EXE）で`/NODEFAULTLIB`を使用する方法や、`-ffreestanding`フラグの活用、さらにはオブジェクトファイルを手動でリンクするワークフローなどの具体的な回避策が提案されています。また、根本的な解決にはターゲットトリプルの変更や、ABIの期待値に合わせたランタイム設計が必要であるといった、システムプログラミングの深層に踏み込んだアドバイスがなされています。

この議論がウェブアプリケーションエンジニアにとって重要な理由は、現代のAIによるコード生成や、高度に抽象化された開発手法が普及する一方で、その実行基盤となるコンパイラやランタイムの挙動が「ブラックボックス」になりがちであるという点にあります。AIツールが生成する低レイヤーのコードをトラブルシューティングしたり、WebAssemblyやエッジコンピューティングなどの特殊な環境に最適化された独自の実行環境を構築したりする場合、こうしたコンパイラとターゲット環境の密接な関係を理解していることが、開発効率とパフォーマンスの決定的な差別化要因となります。ツールに頼り切るのではなく、必要に応じて基盤技術の仕様まで遡って分析する重要性を著者は示唆しています。