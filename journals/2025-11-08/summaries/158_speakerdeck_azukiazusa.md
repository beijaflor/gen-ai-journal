## MCP サーバーの基礎から実践レベルの知識まで

https://speakerdeck.com/azukiazusa1/mcp-sabanoji-chu-karashi-jian-reberunozhi-shi-made

AIエージェントの外部システム連携を標準化するModel Context Protocol (MCP)の基礎から、実践的なサーバー構築と設計のノウハウを解説します。

**Content Type**: 📖 Tutorial & Guide
**Language**: ja

**Scores**: Signal:5/5 | Depth:5/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 95/100 | **Annex Potential**: 92/100 | **Overall**: 92/100

**Topics**: [[MCP, AIエージェント, LLM連携, ツール設計, コンテキスト管理]]

本記事は、AIエージェントが外部システムと連携するための標準規格であるModel Context Protocol（MCP）について、その基礎から実践的なサーバー構築、そして本番環境での設計における知見や失敗談を深く掘り下げて解説しています。

まず、MCPがAnthropic社によって開発された「AIアプリケーション用のUSB-Cポートのようなもの」であり、LLMの知識カットオフやChatGPTプラグインの独自実装といった課題を解決するために、外部ツールのインターフェースを統一する役割を担っていると説明します。MCPの仕組みとして、JSON-RPC 2.0を用いたクライアント・サーバーモデルや、stdio/Streamable HTTPなどのトランスポートが紹介され、リソース、プロンプト、ツールという3つの機能の中から「ツール」に焦点を当てています。

実践パートでは、TypeScript SDKを用いたMCPサーバーの構築手順が詳細に解説されます。`@modelcontextprotocol/sdk`や`zod`、`@modelcontextprotocol/inspector`といった主要なライブラリを使って、サイコロツールを実装する具体的なコード例が示され、ツールの命名規則、descriptionの重要性、inputSchemaとoutputSchemaの定義方法、そしてMCP InspectorやClaude Desktopでの動作確認方法まで丁寧に案内されています。

記事の後半では、実際の開発経験に基づく実践的な知見と失敗談が共有され、ウェブアプリケーションエンジニアにとって特に重要な示唆が与えられます。

1.  **APIのラッパーとして提供してしまう失敗**: 従来のREST API設計とは異なり、LLM向けのツールは「タスクベース」で設計すべきであると著者は強調します。LLMは複数のツールを組み合わせてタスクを達成するのが苦手なため、一つのタスクを一つのツールで完結させるよう、ツールの実装内部で複数のAPIを呼び出すアプローチが推奨されています。カレンダーAPIの例を挙げ、`schedule_meeting`のようにユースケースを意識したツール設計が重要だと説明しています。
2.  **レスポンスのコンテキストサイズが大きすぎる問題**: LLMにはコンテキスト長の制限があり、過大なレスポンスはエラーや性能低下を招きます。従来のプログラミングのように大量のデータを返すのではなく、ページネーションの導入、必要なフィールドのみの取得、またはデータ粒度（詳細/要約）を選択させるなどの工夫で、限られたコンテキスト内で最適な情報を提供する解決策が提示されています。
3.  **LLMが正しいツールの呼び出し方を理解していない問題**: LLMが誤ったツール呼び出しを繰り返すケースへの対処法が示されています。ツールの`description`にプロンプトエンジニアリングの知識を適用し、特殊なクエリ形式や使用例をFew-shotで明示することで、LLMの呼び出し判断を改善します。また、エラー応答も「Not Found」のような抽象的なものではなく、問題解決に役立つ具体的かつ実用的な情報をマークダウン形式で返すことが重要であると述べています。

その他、「IDよりも人間が読める名前を使う」ことや「実際にツールを試してフィードバックを収集する」ことの重要性も指摘し、LLMのツール呼び出しが決定的ではないため、継続的な改善が不可欠であると結論付けています。本記事は、MCPを利用してAIエージェントの機能を拡張し、より堅牢で効率的なシステムを構築するための実践的なガイドとして非常に有用です。