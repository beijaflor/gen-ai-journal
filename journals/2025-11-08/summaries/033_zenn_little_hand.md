## Claude Codeでトークン使用量とGitブランチをリアルタイム表示する方法(解説あり)

https://zenn.dev/little_hand_s/articles/dbd5fc27f5a2f0

このガイドは、Claude Codeのステータスラインをカスタマイズし、トークン使用量、Gitブランチ名、およびセッションIDをリアルタイムで表示することで、効率的なAI駆動開発を支援します。

**Content Type**: ⚙️ Tools
**Language**: ja

**Scores**: Signal:4/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 86/100 | **Annex Potential**: 84/100 | **Overall**: 84/100

**Topics**: [[Claude Code, トークン管理, Git連携, 開発効率化, AI駆動開発]]

この記事は、Claude Codeのステータスラインをカスタマイズし、開発者がAIとの対話コンテキストをより詳細に管理するための具体的な方法を解説しています。主な目的は、Claude Codeの自動圧縮機能による予期せぬ中断やコンテキストの精度低下を防ぎ、開発プロセスをスムーズに進めることです。

著者は、以下の4つの課題解決を強調しています。
1.  **コンテキスト満杯前に対処できる**: 現在のトークン使用量をリアルタイムで可視化することで、自動圧縮が始まる前に計画的にセッションを切り替えたり、作業記録をmdファイルに出力したりするタイミングを判断できます。パーセンテージに応じて色分け表示され、視覚的に残りの余裕を把握できます。
2.  **区切りの良いタイミングで圧縮できる**: 手動で`/compact`コマンドを実行する最適なタイミングを計れるため、自動圧縮による作業中断のストレスを解消し、重要な情報のみを残すようにカスタム指示で圧縮することも可能です。
3.  **作業コンテキストが一目で分かる**: 現在のディレクトリ名とGitブランチ名を常時表示することで、複数プロジェクト間の移動やブランチの切り替え忘れを防ぎ、常に作業状況を正確に把握できます。
4.  **セッション管理が楽になる**: フルセッションIDが表示されるため、`claude -r <session-id>`コマンドで簡単に中断したセッションを再開でき、複数のセッションを使い分ける際の利便性が向上します。

具体的な設定手順として、`~/.claude/statusline.js`に指定されたJavaScriptコードをコピーペーストし、実行権限を付与、さらに`~/.claude/settings.json`に設定を追加するだけで、5分程度で完了すると説明しています。技術的な補足として、トークン計算は会話履歴ファイル`~/.claude/projects/{project_dir}/{session_id}.jsonl`から最後のassistantメッセージのusageフィールドを基に行われ、`/context`コマンドの表示とは異なる（`Autocompact buffer`を含まない）実際のメッセージトークン数に近い値であることを解説しています。

このカスタマイズは、Claude Codeのユーザーがコンテキスト管理における不便さを解消し、より制御された形でAIとの協調作業を進める上で非常に実用的なソリューションを提供します。