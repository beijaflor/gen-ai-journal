## 冴えた Claude Code の育て方（50 本の SQL を dbt 化した話）

https://www.m3tech.blog/entry/2025/11/06/110000

エムスリーは、50本のSQLをdbtへ移行する作業において、Claude Codeと協働しながら「手順書」を段階的に育成し、AIによる高精度な自動化と品質向上を実現しました。

**Content Type**: 📖 Tutorial & Guide
**Language**: ja

**Scores**: Signal:5/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:5/5
**Main Journal**: 92/100 | **Annex Potential**: 90/100 | **Overall**: 92/100

**Topics**: [[dbt, SQL移行, Claude Code, プロンプトエンジニアリング, AI活用]]

エムスリーのデータ基盤チームは、約50本のSQLデータパイプラインをdbt（データ変換ツール）に移行する作業に直面しました。手作業での移行は膨大な工数とミスのリスクが伴うため、Claude Codeを活用して自動化を試みました。しかし、最初の「xxx.sqlをdbt化してください」という簡素なプロンプトでは、コメント消失、不必要なロジックの変更、制約の欠落といった問題が発生しました。

この課題に対し、著者はClaude Codeに「今回の作業で得た知見を活かして次回以降の作業に役立つ手順書を作ってください」と依頼する革新的なアプローチを採用しました。これにより、AI自身が参照・更新する「dbtモデル移行手順書」が誕生。この手順書は、当初の基本的な構成から、参照先の`sources`定義の追加漏れチェック、パーティション/シャーディングテーブルへの対応、トラブルシュート方法、さらにはセルフレビューの章に至るまで、実践的な知見が繰り返し追記され、詳細かつ堅牢な内容へと進化しました。

手順書が成熟するにつれて、Claude Codeは「手順書.mdを参照してください」という指示だけで、多様なパターンのSQLに対してほぼ一発で正確なdbtコードを出力できるようになりました。これにより、手作業で20〜30分かかっていた作業が数分で完了するようになり、大幅な効率化を実現。さらに、実装だけでなく、QA環境へのデプロイから動作検証までの一連の作業も手順書に組み込み、AIに任せることで、エンジニアは並行して別の作業を進めることが可能になりました。

細かい工夫として、Claude Codeが手順書を読み飛ばさないよう冒頭に「必ず全文読み込んでください」という注意書きをAI自身に記載させたり、セルフレビューのチェックリストを導入してAIが自身のミスに気づき修正する仕組みを構築したりしました。

最終的に、50本中半分以上のSQL移行をClaude Codeが不具合なく完遂し、dbt化がスムーズに進みました。この取り組みから得られた「手順書」はGitリポジトリで管理され、組織全体の知見として資産化されたと著者は結論付けています。本稿は、AIとの効果的な協働を通じて、大規模な移行作業の品質と効率を劇的に向上させる実践的な手法を提示しており、同様の課題に直面するエンジニアにとって非常に価値のある示唆を与えています。