## MCPによるコード実行：より効率的なAIエージェントの構築

https://www.anthropic.com/engineering/code-execution-with-mcp

**Original Title**: Code execution with MCP: building more efficient AI agents

Anthropicは、Model Context Protocol (MCP) を用いるAIエージェントが、ツール連携の効率を大幅に向上させ、トークン消費とレイテンシを削減するために、直接ツール呼び出しからコード実行への移行を提唱します。

**Content Type**: ⚙️ Tools
**Language**: en

**Scores**: Signal:5/5 | Depth:5/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 94/100 | **Annex Potential**: 90/100 | **Overall**: 92/100

**Topics**: [[AIエージェントの最適化, コード実行によるツール連携, 大規模言語モデルのコンテキスト管理, トークン消費の削減, プライバシー保護機能]]

Anthropicは、AIエージェントが外部システムと連携するためのオープン標準であるModel Context Protocol (MCP) を利用する際、より効率的なアプローチとして「コード実行」を提案しています。これまでのMCPクライアントでは、すべてのツール定義をエージェントのコンテキストウィンドウに直接ロードし、中間結果もモデル経由でやり取りするため、大量のトークンを消費し、特にツールの数やデータ量が増えるとコストとレイテンシが増大するという課題がありました。例えば、Google DriveからSalesforceへのデータ転送では、トランスクリプト全体がコンテキスト内を何度も往復し、50,000トークン以上の無駄が生じる可能性がありました。

この課題に対し、AnthropicはMCPサーバーを直接ツール呼び出しではなく「コードAPI」として提示し、エージェントにコードを書かせて対話させる方法を提案します。具体的には、利用可能なツールをファイルシステムのように構造化し（例: `servers/google-drive/getDocument.ts`）、エージェントが必要なツール定義だけをオンデマンドで読み込むようにします。これにより、トークン使用量を最大98.7%削減（150,000トークンが2,000トークンに）できると示されています。

このアプローチの主な利点は多岐にわたります。第一に、**プログレッシブ開示**により、モデルは必要なツール定義のみを読み込み、コンテキストの肥大化を防ぎます。第二に、**コンテキスト効率の良いツール結果**を実現し、大量のデータセット（例: 10,000行のスプレッドシート）をコード実行環境内でフィルタリングや変換することで、モデルに渡す情報を最小限に抑えられます。第三に、ループ、条件分岐、エラー処理といった複雑な**制御フロー**をコードで直接記述できるため、より強力かつ効率的な処理が可能になります。第四に、中間結果をコード実行環境内に留めることで、モデルが機密データにアクセスするのを防ぎ、必要に応じてデータをトークン化してモデルから隠蔽する**プライバシー保護機能**が向上します。最後に、エージェントが中間結果をファイルに保存したり、一度開発したコードを再利用可能な「スキル」として永続化したりできる**状態永続化とスキル**の概念を導入し、エージェントの能力を段階的に進化させることができます。

ただし、コード実行はサンドボックス化されたセキュアな実行環境の確保、リソース制限、監視といった複雑性を伴うため、導入には運用上のオーバーヘッドとセキュリティ面の考慮が必要となります。しかし、トークンコスト削減、レイテンシ短縮、ツール連携の強化といったメリットは、これらの実装コストを上回るものとAnthropicは主張しています。