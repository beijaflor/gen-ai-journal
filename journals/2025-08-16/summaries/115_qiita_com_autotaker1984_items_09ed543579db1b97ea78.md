## GPT-5のCFG function callingを試してみた Part 2: SQL

https://qiita.com/autotaker1984/items/09ed543579db1b97ea78

文法制約（CFG）を用いたファンクションコーリングは、自然言語から厳密な文法ルールに従い安全なSQLクエリを生成し、意図しない操作を防止する。

**Content Type**: Research & Analysis

**Scores**: Signal:5/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 87/100 | **Annex Potential**: 86/100 | **Overall**: 88/100

**Topics**: [[Function Calling, Context-Free Grammar, SQL Generation, Secure Coding, NL2SQL]]

本記事は、GPT-5のファンクションコーリングに文法制約（CFG）を適用し、自然言語からSQLクエリを安全かつ正確に生成・検証する革新的な手法を詳述しています。従来のJSONベースのSQL生成が抱える、データベースごとの文法方言、構文の厳密性欠如、そして致命的なSQLインジェクションのリスクといった課題に対し、CFGは極めて有効な解決策を提示します。Larkライブラリを用いてSQLの文法を厳密に定義することで、生成されるクエリは常に正しい構文を持ち、意図しない危険な操作（例：INSERTやDELETE）を確実にブロックできることを実証しました。

著者は、SELECT、JOIN、WHERE、LIMITを含むSQLの最小サブセットを定義し、PythonとSQLite環境で広範な実験を実施。日本語の自然文の指示から、この厳格な文法制約内で正しいSQLを生成することに成功しています。特に重要なのは、定義外の操作（例：INSERT文や集計関数）をモデルに指示した場合に、ツール呼び出しを拒否しエラーメッセージを返す、あるいは許可された範囲内で代替のSQLを賢く生成するなど、文法制約が期待通りに機能し、安全性を担保する様子が明確に示された点です。

複数のGPT-5モデル（標準、mini、nano）でのパフォーマンス比較でも、全てのモデルが制約に従った信頼性の高いSQLを生成し、特に軽量なmini/nanoモデルが高速に動作することが確認されました。このアプローチは、自然言語処理を用いたデータベース操作インターフェース（NL2SQL）を開発するウェブアプリケーションエンジニアにとって、生成されるSQLの信頼性とセキュリティを飛躍的に向上させる可能性を秘めています。SQLインジェクションのリスクを大幅に削減し、より堅牢で安全なシステムを構築できるため、実務への応用が強く期待される技術です。