## Claude Codeを手懐けてAndroidアプリ高速リファクタリング

https://www.m3tech.blog/entry/2025/11/26/170000

エムスリーのエンジニアが、10年以上前のレガシーAndroidアプリをClaude Codeを使ってKotlinへ高速リファクタリングした経験を共有し、AIを効果的に活用するための具体的な秘訣を提示します。

**Content Type**: ⚙️ Tools
**Language**: ja

**Scores**: Signal:5/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:5/5
**Main Journal**: 91/100 | **Annex Potential**: 90/100 | **Overall**: 92/100

**Topics**: [[AI Assisted Refactoring, Android Development, Kotlin Migration, Legacy Code Modernization, Claude Code]]

エムスリーのエンジニアリンググループGMが、10年以上前のAndroidレガシーアプリをClaude Code (v2.0.50, Sonnet 4.5) を活用してKotlinへ高速リファクタリングした経験を詳細に解説しています。対象アプリはAsyncTaskやstartActivityForResultなどの非推奨APIへの依存、Activityの肥大化、シングルトンの神クラスといった課題を抱えており、モダンなアーキテクチャ（MVVMライクなViewModel/Repository層、HiltによるDI）への移行が急務でした。

著者は、Claude Codeを効果的に利用するための具体的な秘訣を複数紹介しています。まず、コード生成の前にClaude Codeに画面遷移や機能ごとの複雑さを分析させ、リファクタリング計画を立てるためのドキュメントを整備することが重要であると強調。次に、アーキテクチャとDIツール（Hilt）を早期に確定させることで、AIに明確なガイドラインを与え、UI層のリファクタリングを効率化できると述べています。古い神クラスはRepository層以下に隔離し、最後にAIで機能ごとに分類・リファクタリングするアプローチが有効でした。

また、リファクタリング中は元のコードを極力残しつつ、リファクタリング前後の区別を明確にすること、そして、AIが非推奨APIを生成しないよう、Kotlin CoroutinesやActivityResultLauncherなど、使用するライブラリやAPIを明確に指示する必要があるとしています。さらに、理想的なActivityの実装パターンを一つ作成し、それを参考に他のActivityのリファクタリングをAIに指示することで、80〜90点のコードが一発で生成されると説明。巨大なActivityのリファクタリングでは、AIのコンテキスト溢れを防ぐため、タスクを小分けにして段階的に進めることが推奨されています。

最終的には、AI生成コードを実際に動かして詳細な動作確認を行い、差異があればAIに元の実装との比較修正を指示することで、精度の高いリファクタリングが可能になります。これらの手法により、約1ヶ月で全画面の3分の1のリファクタリングが完了し、手動での作業に比べて驚異的な速度でプロジェクトが進捗していると報告。AIエージェントが知識不足を補い、面倒な繰り返し作業を代行することで、コーディングの楽しい部分に集中できる「良い時代」が到来したと締めくくっています。