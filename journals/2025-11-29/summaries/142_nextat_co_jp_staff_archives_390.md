## AGENTS.mdの肥大化を解消したい。Codex で「役割」を擬似的に切り替えてみる

https://nextat.co.jp/staff/archives/390

Codex CLIにおけるAGENTS.mdの肥大化とコンテキスト汚染の問題を解消するため、役割別に分割したエージェント定義ファイルをカスタムプロンプトで動的に切り替える実践的なアプローチを提示する。

**Content Type**: ⚙️ Tools
**Language**: ja

**Scores**: Signal:4/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:5/5
**Main Journal**: 88/100 | **Annex Potential**: 87/100 | **Overall**: 88/100

**Topics**: [[Codex CLI, AGENTS.md, AIエージェント, プロンプトエンジニアリング, 開発ワークフロー改善]]

本記事は、Codex CLIのAGENTS.mdファイルが肥大化し、可読性の低下、メンテナンスの困難さ、そしてAIへのコンテキストノイズによる回答精度の低下といった問題が生じている現状を指摘している。理想としてはClaude Codeのようなサブエージェント機能による役割の切り替えだが、Codex CLIには標準機能として提供されていない。そこで著者は、既存のカスタムプロンプト機能を活用し、役割ごとのコンテキストを擬似的に切り替える方法を提案する。

具体的な解決策として、まず肥大化したAGENTS.mdを、AIに与えたい「役割」ごとに分割し、プロジェクト内の`.codex/agents/`ディレクトリに配置する。この配置は、Gitによるチーム共有、特定のプロジェクトに特化したルールのローカル性、変更時のレビュー範囲の限定によるメンテナンスの容易さといったメリットを生む。各役割ファイルには、バックエンドエンジニアやコードレビュワーといった専門分野に特化した指示と制限事項を記述する。

次に、ホームディレクトリ配下の`~/.codex/prompts/`にカスタムプロンプトファイル（例: `agents.md`）を作成し、引数に基づいて役割ファイルを読み込むロジックを記述する。これにより、ユーザーは`/prompts:agents backend`のようにコマンドを実行するだけで、AIの役割を特定の専門分野に動的に切り替えられるようになる。これにより、AIが余分なルールを読み込む非効率が解消され、回答の精度向上に繋がるという。

著者はこの手法が、AGENTS.mdの肥大化とコンテキスト汚染というチーム開発における課題に対し、現状で可能な一例として有効であると結論付けている。しかし、最終的にはCodex CLI公式がサブエージェント機能のような、より洗練された動的なコンテキスト切り替えメカニズムを標準で実装することを望んでいる。