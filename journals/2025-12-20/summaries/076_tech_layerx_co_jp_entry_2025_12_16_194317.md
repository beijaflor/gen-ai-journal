## LLMを用いて長文ドキュメントを速く・安く・安全に構造化する試み

https://tech.layerx.co.jp/entry/2025/12/16/194317

LayerXのAi Workforce事業部は、長文ドキュメントをLLMで構造化する際の課題（精度、速度、コスト）を解決するため、テキストの「編集」アプローチを提案し、検証しています。

**Content Type**: ⚙️ Tools
**Language**: ja

**Scores**: Signal:4/5 | Depth:4/5 | Unique:4/5 | Practical:3/5 | Anti-Hype:4/5
**Main Journal**: 74/100 | **Annex Potential**: 76/100 | **Overall**: 76/100

**Topics**: [[LLM, ドキュメント構造化, コスト削減, 精度向上, YAML]]

LayerXのAi Workforce事業部は、エンタープライズ向けに契約書や見積書といった長大なドキュメントの処理を効率化する中で、LLMを用いたドキュメント構造化における課題に直面しています。具体的には、LLMが不正確な情報を出力したり、元の記述を変更したり、特定の情報が抽出から漏れるリスクに加え、長文全体を処理する際の速度低下と高コストが問題でした。特に、10万トークンを超える契約書全体を構造化データとしてLLMに直接出力させる方法は、これらの課題を顕著に引き起こします。

これらの課題に対処するため、同事業部はドキュメント構造化の新しいアプローチとして、「テキストの分割・抽出」ではなく「ファイルの編集」のようにLLMを利用する方法を考案し、試行しています。この手法では、LLMにドキュメントの元の文章を直接変更させるのではなく、「どの行にどのようなYAMLキーを挿入すべきか」という指示のみを生成させます。これにより、LLMが生成するトークン数を大幅に削減し、処理速度とコストの改善を目指します。

このアプローチの利点として、著者は以下の点を強調しています。
- **精度懸念の軽減**: LLMはYAMLの文法上のキーのみを出力し、ドキュメントの文章自体は変更しないため、誤った記述が挿入されるリスクが低減されます。
- **抽出漏れの防止**: 行番号でテキスト全体を管理するため、ルールベースでのフォールバック処理を追加しやすく、情報が漏れることなく出力に含めることが可能になります。
- **コストと速度の最適化**: LLMの出力トークンが大幅に削減されることで、処理速度が向上し、運用コストを抑えることができます。
- **構造化の拡張性**: YAML形式の採用により、階層構造や配列表現が可能となり、Pydanticなどのモデルを用いて変換後の構造を検証することで、より柔軟で厳密な構造化を実現できます。

実際に農林水産省の契約書雛形を用いた検証では、第一条、第二条といった大きな粒度での分割はできたものの、細かい階層の認識やYAML形式のインデントミスなどが課題として浮上しました。しかし、著者はこれらの課題も、入力の分割やエラーメッセージに基づいた再処理によって改善の余地があると考えています。

結論として、この「行番号を付与してLLMに操作させる」というアプローチは、LLMの不確実性やコストを抑えながら長文ドキュメントを構造化する有効な手段となる可能性を秘めており、精度のさらなる検証と改善が今後の焦点です。これは、LLMをそのまま使うのではなく、LLMを補助的なツールとして活用し、より制御可能で効率的なワークフローを構築するための重要な示唆となります。