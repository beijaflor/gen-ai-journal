## ForgejoインスタンスをAIクローラーから保護するシンプルなNginx設定

https://her.esy.fun/posts/0031-how-i-protect-my-forgejo-instance-from-ai-web-crawlers/index.html

**Original Title**: How I protect my forgejo instance from AI Web Crawlers

AIクローラーによる過剰なアクセスから自作のGitインスタンスを守るため、JavaScriptを用いたクッキー付与による軽量なアクセス制限手法を提案する。

**Content Type**: ⚙️ Tools
**Language**: en

**Scores**: Signal:5/5 | Depth:3/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 85/100 | **Annex Potential**: 83/100 | **Overall**: 84/100

**Topics**: [[Forgejo, Nginx, AIクローラー, Webスクレイピング, セルフホスト]]

著者のYann Esposito氏は、自身でホストしているForgejo（セルフホスト可能なGitサービス）インスタンスが、AI学習用などのウェブクローラーによって頻繁にダウンさせられる問題に直面した。これらのクローラーは`robots.txt`を無視し、リポジトリを効率的にクローンするのではなく、ウェブAPIを介して数千のコミットを執拗にスキャンするため、システムに壊滅的な負荷をかけていたという。著者は当初、アクセスを完全に遮断したが、それでは公開フォージとしての役割を果たせないため、より実用的でユーザーへの摩擦が少ない解決策を模索した。

最終的に著者が採用したのは、Nginxの設定のみで完結する非常にシンプルな「クッキー強制」戦略である。具体的には、アクセス時に特定のクッキーを持っていないユーザーに対し、HTTPステータスコード418（I'm a teapot）とともに、クッキーをセットしてページをリロードする短いJavaScriptコードを返す仕組みだ。この手法の巧妙な点は、`git clone`などのコマンドラインによるアクセスはUser-Agent判定（`git/`や`git-lfs/`）でホワイトリスト化して通しつつ、ブラウザを利用する人間には、透過的なリダイレクトのみでアクセスを許可する点にある。

著者は、既存の保護ツールである「Anubis」などが自身の小規模なニーズには重すぎると判断し、この「クイックでダーティな」修正を選択した。このアプローチの最大の意義は、インフラへの負担を最小限にしつつ、JavaScriptを実行しない（あるいはクッキーを処理しない）単純なボットを効果的に排除できることにある。著者は、これがJavaScriptを必須にするというトレードオフを伴うことを認めつつも、現在のクローラーの多くは質より量を重視しており、個別のサイトのJavaScriptによる防壁を突破するためにリソースを割くことは稀であるため、現時点では十分な防御効果を発揮していると述べている。セルフホスト環境を運用するエンジニアにとって、複雑なWAFや高度な防御システムを導入する前の、実用的な第一防衛線として非常に有用な知見といえる。