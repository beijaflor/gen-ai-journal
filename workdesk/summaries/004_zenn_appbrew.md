## チームのCLAUDE.mdが勝手に育つ - Hook機能での自動化

https://zenn.dev/appbrew/articles/e2f38677f6a0ce

Claude CodeのHook機能を活用し、AIとの会話履歴からチームのCLAUDE.mdに追記すべきルールを自動提案するシステムを構築・運用することで、知識共有の課題を解決する。

**Content Type**: ⚙️ Tools
**Language**: ja

**Scores**: Signal:4/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 86/100 | **Annex Potential**: 84/100 | **Overall**: 84/100

**Topics**: [[AIエージェント, 開発ワークフロー自動化, Claude Code, 知識共有, フック機能]]

筆者は、AIとの会話履歴からチームのルールや知見をまとめる「CLAUDE.md」の更新が、スラッシュコマンドでは忘れられがちで、チーム全体での運用が難しいという課題を指摘します。この問題を解決するため、Claude CodeのHook機能を利用し、CLAUDE.mdへの追記提案を完全に自動化する仕組みを開発しました。

このシステムは、Claude Codeのセッション終了時（SessionEnd）とコンテキスト圧縮前（PreCompact）のイベントをトリガーに、会話履歴を分析してCLAUDE.mdに追記すべき内容を自動で提案するものです。提案はターミナルに表示され、ユーザーが「この内容をCLAUDE.mdに追記してください」と指示することで反映できます。これにより、新しく入ったメンバーが既存ルールの存在を知らない、ベテランメンバーが当たり前と捉えてしまうといった知識共有の課題を解決し、チームの知識が自然と蓄積されると著者は述べています。

具体的な実装としては、`.claude/settings.json`でSessionEndとPreCompactの両フックにカスタムスクリプト（`bin/suggest-claude-md-hook.sh`）を登録しています。このスクリプトは、無限ループを防ぐための環境変数管理、Claudeの会話履歴JSONLファイルからの履歴抽出、そして専用のClaudeコマンドを新しいターミナルウィンドウで実行して提案を生成します。提案生成時に新しいClaudeプロセスを起動するため、既存のコンテキストウィンドウへの影響がない点が工夫されています。

著者は約1ヶ月の運用で、問題なく提案が自動実行されていることを報告し、この仕組みがチームの知識蓄積に貢献すると期待しています。AIがプロンプト内の指示を忘れやすいという経験を踏まえ、フックによる自動化がより確実な運用につながることを強調しています。