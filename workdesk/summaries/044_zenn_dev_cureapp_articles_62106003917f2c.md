## 1Password CLI で mcp サーバーに渡すトークンを管理する

https://zenn.dev/cureapp/articles/62106003917f2c

AIツールとの連携におけるトークン管理のセキュリティリスクを解消するため、1Password CLIを活用してmcpサーバーへの安全なトークン受け渡し方法を解説します。

**Content Type**: 📖 Tutorial & Guide
**Language**: ja

**Scores**: Signal:4/5 | Depth:3/5 | Unique:3/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 100/100 | **Annex Potential**: 98/100 | **Overall**: 76/100

**Topics**: [[1Password CLI, トークン管理, セキュリティ, mcpサーバー, Claude Code]]

AIと様々なツールを連携させる機会が増える中で、mcpサーバーのようなサービスに各種APIトークンを渡す際の認証情報管理は重要な課題です。ローカル環境に直接トークンを保存すると、npmサプライチェーン攻撃のような鍵漏洩リスクに晒されるため、適切な管理が不可欠となります。この記事では、CureApp社内で活用されている1Password CLIを用いて、このトークン管理のセキュリティと利便性を両立させる具体的な方法が紹介されています。

筆者は、以下の手順でmcpサーバーに安全にトークンを渡す仕組みを構築することを推奨しています。まず、1Password CLIとデスクトップアプリをインストールし、CLIとデスクトップアプリを統合することで生体認証連携を可能にします。次に、各種サービスで発行したトークンを1Passwordに保存し、そのトークンの「秘密参照先」をデスクトップアプリから取得します。この秘密参照先（例: `op://Employee/token/credential`）が、トークンにアクセスするための鍵となります。

mcpサーバーへのトークン受け渡しには、直接環境変数にセットするのではなく、一工夫が必要です。具体的には、秘密参照先を記述した環境変数ファイル`.env.op`を作成し、mcpサーバーを起動するシェルスクリプトを用意します。このスクリプト内で`eval "$(op signin)"`で1Passwordにログインし、`op run --env-file=/Users/username/.env.op -- /Users/username/work/mcp-servers/app/dist/index.js`のように`op run`コマンドと`.env.op`ファイルを組み合わせてmcpサーバーを実行します。これにより、mcpサーバーは環境変数経由で1Passwordから安全にトークンを取得できるようになります。Claude CodeのようなAIツールからmcpサーバーを設定する際には、このシェルスクリプトへのパスを指定します。

この方法を採用することで、トークンを平文でローカルに保存するリスクを回避し、生体認証によるセキュリティと利便性の両立が実現できると筆者は述べています。mcpサーバーだけでなく、各種APIトークン管理全般に応用できる、セキュアな開発環境構築のための実践的なアプローチです。