## SSRFのやられアプリを作ってみた ~Gemini CLIを活用して~

https://qiita.com/whoami_priv/items/59df45fd40a31ab9b110

SSRFの危険性を実践的に学ぶため、Gemini CLIを用いてOGPプレビュー機能を持つ脆弱なWebアプリケーションの構築と攻撃手法を解説する。

**Content Type**: 📖 Tutorial & Guide

**Scores**: Signal:4/5 | Depth:4/5 | Unique:3/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 85/100 | **Annex Potential**: 79/100 | **Overall**: 80/100

**Topics**: [[SSRF, Webセキュリティ, 脆弱性診断, Docker, Gemini CLI]]

この記事は、Webアプリケーションエンジニアが直面する可能性のある危険な脆弱性「SSRF（Server-Side Request Forgery）」の仕組みと対策を、具体的な「やられアプリ」を通じて解説しています。SSRFとは、サーバーがユーザー指定のURLへアクセスする際に適切な検証が行わずに、攻撃者が意図しない内部リソースや外部サービスへアクセスさせることを可能にする脆弱性です。これにより、通常は直接到達できない内部ネットワークのサービス、AWSなどのクラウド環境のメタデータ、さらにはサーバーのローカルファイルシステムなどへ不正にアクセスし、機密情報の漏洩や認証回避、内部システムへの攻撃といった深刻な脅威を引き起こします。

著者は、Gemini CLIを活用してOGP（Open Graph Protocol）プレビュー機能を持つ脆弱なWebアプリケーションをDocker環境で構築し、その攻撃方法を実演しています。このアプリケーションは、外部公開された`frontend`サービスと、ポートを公開していない`internal_api`サービスが同一ネットワーク内で稼働する構成です。OGPプレビュー機能が実装された`frontend`の`/fetch`エンドポイントは、ユーザーが入力したURLを検証せずに`requests.get()`で取得し、その結果を返します。この実装上の欠陥を悪用し、OGPのURL入力欄に`internal_api`のURLや`file:///etc/passwd`のようなローカルファイルのパスを入力することで、本来取得できないはずの内部DB情報やシステムファイルの内容が漏洩する様子が示されています。

この事例は、Webアプリケーション開発においてユーザーからのURL入力をサーバー側で処理する機能がいかに危険であるかを浮き彫りにします。特に、URLスキーム（`http`, `https`だけでなく`file`なども）やドメインに対する厳格なホワイトリスト検証を怠ると、アプリケーションの信頼性が根底から覆されるリスクがあります。Webアプリケーションエンジニアは、外部リソースへのアクセスを伴う機能を実装する際に、SSRF攻撃からシステムを保護するための徹底した入力検証とセキュリティ対策を講じる必要があります。