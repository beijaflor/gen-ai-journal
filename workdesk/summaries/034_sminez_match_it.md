## 構造的正規表現：Samエディタの強力な概念をRustで再構築する

https://www.sminez.dev/match-it-again-sam/

**Original Title**: Match it again Sam

著者は、Rob PikeのSamエディタに由来する「構造的正規表現」の概念を紹介し、その強力なテキスト処理能力をRustクレート`structex`で現代的に再実装する方法を解説します。

**Content Type**: ⚙️ Tools
**Language**: en

**Scores**: Signal:5/5 | Depth:5/5 | Unique:5/5 | Practical:5/5 | Anti-Hype:5/5
**Main Journal**: 100/100 | **Annex Potential**: 100/100 | **Overall**: 100/100

**Topics**: [[構造的正規表現, Rustプログラミング, テキスト処理, CLIツール, プログラミング言語設計]]

Rob PikeのSamテキストエディタで導入された「構造的正規表現」は、通常の正規表現を組み合わせてテキストの構造をより効果的に記述するための強力なアプローチを提供します。筆者は、この概念が、特に複数のフィールドの順序が不定なレコードから特定の情報を抽出するような、複雑なテキスト処理タスクにおいて、従来の正規表現では対応しきれない課題を解決すると主張しています。例えば、不揃いな形式のプログラマーリストから名前と言語を抽出する例を通じて、構造的正規表現がどのようにテキストを意味のあるチャンクに分解し、フィルタリングし、必要な情報を抽出するかを具体的なパイプライン構文（`y/\n\n/ g/programmer/ x/name: (.*)@*lang.*: (.*)/ p/{1} prefers {2}/`）で示しています。

このパイプライン構文は、テキストを区切り（y）、フィルタリングし（g, v）、パターンを抽出し（x）、そしてマッチした部分に対して特定のアクション（a/append, i/insert, c/change, p/print, d/delete）を適用します。さらに、複数のパイプラインを並行して実行できる「並列グループ」構文も紹介されており、例えば「Emacs」と「Vim」を同時に置換する際に、順次処理による意図しない結果を防ぐなど、複雑な編集操作を安全に行える利点があります。

筆者は、Samエディタの設計から一歩進んで、マッチングエンジンとアクションの適用ロジックを分離することで、より汎用的な構造的正規表現エンジンを開発できると提案します。このアイデアを具体化したのが、自身がRustで開発したクレート`structex`です。`structex`は、特定の構造を特定する部分（オペレーター）と、その構造に対する処理ロジック（アクション）を切り離すことで、ユーザーがアプリケーション固有の処理を柔軟に実装できるように設計されています。記事では、`structex`を使って基本的な`grep`風の出力ツールや`sed`風のテキスト置換ツールを構築するRustコード例が詳細に示されており、開発者がいかにこのクレートを活用して独自のテキスト処理ユーティリティを作成できるかを具体的に解説しています。特に、`structex`の`iter_tagged_captures`メソッドにより、マッチした部分とその関連アクションを効率的に処理できる点が強調されています。このアプローチは、複雑なテキスト構造の解析と操作において、ウェブアプリケーションエンジニアに新たな強力なツールボックスを提供すると筆者は締めくくっています。