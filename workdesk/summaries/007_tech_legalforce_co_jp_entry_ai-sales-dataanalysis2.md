## GeminiでAIの「ブラックボックス」を解明！実装 Tipsとプロンプト全公開

https://tech.legalforce.co.jp/entry/ai-sales-dataanalysis2

LegalOn Technologiesが、営業現場で信頼されるAI予測を実現するため、BigQuery MLとGeminiを活用してSHAP分析結果を自然言語の「MQLファクター」に変換する技術的な実装を詳細に解説します。

**Content Type**: ⚙️ Tools
**Language**: ja

**Scores**: Signal:5/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 89/100 | **Annex Potential**: 87/100 | **Overall**: 88/100

**Topics**: [[LLM応用, プロンプトエンジニアリング, 説明可能なAI, BigQuery ML, Human-in-the-Loop]]

LegalOn Technologiesは、予測AIのスコアが営業担当者にとって「ブラックボックス」となり、信頼されにくいという課題に対し、Geminiを翻訳機として活用するソリューションを構築しました。この取り組みは、専門的なSHAP分析結果を、営業担当者が理解し、行動に繋げられる自然な日本語の「MQLファクター」へと変換するものです。

このソリューションの核となるのは、BigQuery MLの`ML.GENERATE_TEXT`関数を用いた効率的かつセキュアなGenAIパイプラインです。Pythonなどでの複雑なAPI連携を避け、SQLだけでGeminiを呼び出す基盤を構築した点が技術的な工夫として挙げられます。特に、`max_output_tokens`が低いバッチ処理においては、思考プロセスを持たないシンプルなモデル（例: `gemini-2.0-flash-lite-001`）が安定性を高める上で最適であるという知見は、大規模なLLM運用を検討するエンジニアにとって重要です。

プロンプトエンジニアリングにおいては、Geminiにインサイドセールスの「ペルソナ」を与え、「リード情報」と「タスク」を明確にし、さらに理想的な構成や注意事項といった詳細なガードレールを設けることで、AIの出力をビジネス要件に合わせて厳密に制御しました。SHAPの特徴量にはノイズが多いため、ポジティブな寄与度のみを抽出し、特徴量を日本語に翻訳する前処理も実装しています。また、Salesforceの255文字制限への「4層防御」（プロンプト指示、モデルパラメータ、SQLでのバリデーション、リトライ処理）や、説明可能な特徴量がない場合のフォールバック処理など、本番運用における堅牢性が考慮されています。

最も重要な点として、同社はHuman-in-the-Loop、すなわち営業担当者からのフィードバックに基づき、AIのロジックとプロンプトを継続的に改善するプロセスを確立しました。これにより、「なぜ有望か」という理由だけでなく「直近の具体的な行動」が営業にとって最も重要であるという知見を得て、AIの判断プロセスに人間の洞察を反映させています。

これらの工夫により、技術的にはSQLのみで高効率なGenAIパイプラインを実現し、ビジネス上では営業の架電数7%増加という具体的な成果に繋がっています。本記事は、AIのブラックボックス問題解決だけでなく、LLMを実務に組み込む際の具体的な技術的課題と、それに対する実践的な解決策を提示しており、webアプリケーションエンジニアがGenAIシステムを構築・運用する上で非常に参考になるでしょう。