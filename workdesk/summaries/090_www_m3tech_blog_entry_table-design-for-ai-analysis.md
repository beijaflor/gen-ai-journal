## AIに正しく分析してもらうためのテーブル設計戦略

https://www.m3tech.blog/entry/table-design-for-ai-analysis

AIに正しくデータ分析させるため、正規化された複数テーブルによるJOINの複雑さを排除し、非正規化された分析専用の「One Big Table」を導入するテーブル設計戦略を提示します。

**Content Type**: 🛠️ Technical Reference
**Language**: ja

**Scores**: Signal:5/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:5/5
**Main Journal**: 91/100 | **Annex Potential**: 90/100 | **Overall**: 92/100

**Topics**: [[AIデータ分析, テーブル設計, 非正規化, BigQuery, AIエージェント]]

エムスリーのAI・機械学習チームは、AIエージェントがBigQuery上のデータを正確に分析できるようにするためのテーブル設計戦略を解説しています。AIの進化により、ビジネスサイドのメンバーが自然言語でデータ分析を行える「データ分析の民主化」が進む一方で、正規化された多数のテーブルをAIが扱う際に、JOIN条件の誤選択による誤集計のリスクが課題となると著者は指摘します。

特に、データベース設計で一般的な正規化されたテーブル構成では、人間にとっても複雑なJOIN処理はAIにとっても難しく、結合ミスを誘発しやすいです。記事では、ECサイトのユーザー、注文、注文明細テーブルを例に挙げ、AIが不必要な明細テーブルまでJOINしてしまうことで、ユーザー数が誤って過剰にカウントされる「行増殖」のリスクとそのビジネス上の悪影響を具体的に示しています。

この課題に対する解決策として、著者はプロンプトエンジニアリングにすべてを依存するのではなく、AIがシンプルかつ得意なタスクに集中できる環境を人間側が用意するアプローチを提案します。具体的には、分析に必要な情報をあらかじめすべて結合し、「分析専用の巨大なテーブル（One Big Table）」、すなわち「非正規化」されたテーブルを一つだけ用意する戦略です。この設計により、AIが生成するSQLからJOIN句が物理的に排除され、集計項目の選択と条件による絞り込みのみに集中できるため、誤りの可能性を最小限に抑えることが期待されます。

ただし、この非正規化戦略の導入には注意が必要です。一つはデータの整合性で、この分析用テーブルはあくまで正規化されたソースデータのリードオンリーなコピーとして運用し、リアルタイムな更新は行わず、日次バッチなどで生成・更新する「Single Source of Truthとしない」運用を推奨しています。もう一つはコストとパフォーマンスのトレードオフです。BigQueryを例に、物理テーブルとして作成すればクエリは高速化するもののストレージコストが増加し、論理ビューとして作成すればストレージコストは抑えられるがクエリ実行時の計算コストが増加する点を考慮すべきと述べています。

著者は、AIモデルの性能向上だけではなく、AIがデータを理解しやすい構造を人間側が整えることが、真の「データ分析の民主化」実現において非常に重要であると結論付けています。