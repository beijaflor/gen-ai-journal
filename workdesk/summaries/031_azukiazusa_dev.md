## Claude Code のツール検索ツールを有効にして MCP のトークン使用量を削減する

https://azukiazusa.dev/blog/enable-claude-code-tool-search-to-reduce-mcp-token-usage/

Claude Codeの環境変数を有効化し、MCPツールをオンデマンドで検索・読み込みさせることで、コンテキストウィンドウの圧迫とトークンコストを劇的に削減する。

**Content Type**: ⚙️ Tools
**Language**: ja

**Scores**: Signal:5/5 | Depth:4/5 | Unique:4/5 | Practical:5/5 | Anti-Hype:4/5
**Main Journal**: 89/100 | **Annex Potential**: 87/100 | **Overall**: 88/100

**Topics**: [[Claude Code, MCP, Token Optimization, LLM Efficiency, Developer Tools]]

Claude CodeにおいてModel Context Protocol（MCP）を活用する際、避けて通れないのが「コンテキストの腐敗（Context rot）」の問題である。これは、タスクに不要なツール定義がコンテキストウィンドウを圧迫し、LLMの推論精度を低下させてしまう現象を指す。著者は、PlaywrightやNext.js Devtoolsなど複数のMCPツールを常時読み込むと、それだけで約39,000トークン（コンテキストの約20%）を消費してしまう実例を挙げ、この無駄が開発効率を阻害していると指摘する。

この記事が提示する解決策は、環境変数 `ENABLE_TOOL_SEARCH=true` を用いた「ツール検索ツール」の有効化だ。この機能を有効にすると、Claude Codeは起動時にすべてのツール定義をコンテキストに読み込まなくなる。代わりに、ユーザーの指示に応じて必要なツールを動的に検索・呼び出しする挙動へと変化する。これにより、コンテキストの専有面積を最小限に抑えつつ、膨大な数のMCPツールを実質的に「使い放題」にできる点が大きなメリットである。

技術的な仕組みとして、Claudeは `MCPSearch(...)` という専用ツールを使用する。これには、ツール名を直接指定する「Direct Selection（select:<tool_name>）」と、タスクの意図からツールを探す「Keyword Search」の2つのクエリモードが備わっている。例えば「スクリーンショットを撮って」という依頼に対し、Claudeはまずキーワード検索でPlaywrightツールを見つけ出し、その後に必要な定義のみをロードして実行する。著者の検証では、最終的に読み込まれたツール関連のトークンは約2,800トークンにまで抑えられており、従来比で90%以上の削減に成功している。

筆者は、LLMが効果的にタスクを遂行するには、コンテキストとして提供する情報を厳選することが不可欠であると強調している。これまでは `/mcp` コマンドで手動の無効化・有効化が必要だったが、この自動検索機能の導入により、エンジニアはMCPツールの管理負荷から解放され、より複雑なエージェントワークフローを低コストかつ高精度に構築できるようになる。ツールを「事前に全て教える」のではなく「必要になったら自分で探させる」というアプローチへの転換は、今後のAIエージェント活用のスタンダードになる可能性を秘めている。